{% extends 'base.html' %}
{%load crispy_forms_tags%}
{%load static%}
{%block title%}an√°lysi{%endblock%}

{%block links%}
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="{% static 'css/data.css' %}">
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>{%endblock%}

{% block nav%}
<ul class="nav-area">
<li><a href="{% url 'logout' %}">Logout</a></li>
</ul>
{% endblock %}
{% block content%}
<div>
    <div class="row no-gutters">
        <div class="col col-sm-2 no-gutters">
            <div class="leftside">
                <form  class="form" id='InputsForm'>
                    <table>
                        {% csrf_token %}
                        {{ form|crispy }}
                    </table>
                 <button id="SubmitButton"type="submit" class="btn btn-success">Chart It</button>
                </form>
            </div>
        </div>
        <div class="col col-sm-10 no-gutters">
            <div class="rightside">
                 <div class="graph">
                     <canvas  id="myDiv"></canvas>
                 </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
var data
var xvalues
var yvalues
var yvalues2
var tt
var myChart
$('#SubmitButton').click(function (event) {
   event.preventDefault(); //so that we stop normal form submit.
   console.log($('form#InputsForm').serializeArray());
   $.ajax({
        type: 'POST',
        url: "{% url 'ajax'%}",
        dataType: 'json',
        data: $('form#InputsForm').serializeArray(),
        success: function (data) {
        console.log(data['dependent_extra_values']);
        xvalues = ['2008','2009','2010','2011','2012','2013','2014','2015','2016','2017','2018'];
        yvalues = data['dependent_values'];
        yvalues2 = data['dependent_extra_values'];
        tt = data['graph_type'];
        chartIt();
      }
   });

   function chartIt(){
        if (tt == 'bar' || tt == 'line'){
            if (myChart) {
                myChart.destroy();
            }
            var ctx = document.getElementById('myDiv').getContext('2d');
            myChart = new Chart(ctx, {
                type: tt,
                data: {
                    labels: xvalues,
                    datasets: [{
                        label: 'number',
                        data: yvalues,
                        backgroundColor: [
                           '#FFFDE7',
                            '#FFF9C4 ',
                            '#FFF59D ',
                            '#FFF176 ',
                            '#FFEE58 ',
                            '#FDD835 ',
                            '#FBC02D',
                            '#F9A825 ',
                            '#F57F17',
                            '#FF6F00 ',
                            '#E65100 '
                        ],
                        options: {
                            layout: {
                                padding: {
                                    left: 50,
                                    right: 0,
                                    top: 0,
                                    bottom: 0
                                }
                            }
                        },
                        borderColor: [
                            'black',
                            'black',
                            'black',
                            'black',
                            'black',
                            'black',
                            'black',
                            'black',
                            'black',
                            'black',
                            'black'
                        ],
                        borderWidth: 2
                    },
                    {
                        label: 'male',
                        data: yvalues2,
                        backgroundColor: [
                           '#0D47A1',
                           '#1565C0',
                           '#1976D2',
                           '#1E88E5',
                           '#2196F3',
                           '#42A5F5',
                           '#64B5F6',
                           '#90CAF9',
                           '#BBDEFB',
                           '#E3F2FD',
                           '#E1F5FE'
                        ],
                        options: {
                            layout: {
                                padding: {
                                    left: 50,
                                    right: 0,
                                    top: 0,
                                    bottom: 0
                                }
                            }
                        },
                        borderColor: [
                            'black',
                            'black',
                            'black',
                            'black',
                            'black',
                            'black',
                            'black',
                            'black',
                            'black',
                            'black',
                            'black',
                        ],
                        borderWidth: 2
                    }
                    ]
                },
                    options: {
                        legend: {
                            display: false,
                        },
                        title: {
                            display: true,
                            text: 'WITWATERSRAND',
                            fontColor: 'white',
                            fontSize: 44
                        },

                    scales: {
                        xAxes: [{
                            display: true,
                            scaleLabel: {
                                display: true,
                                labelString: 'YEARS',
                                fontColor:'white',
                                fontSize:25
                            },
                            ticks: {
                               fontColor: "white",
                               fontSize: 20
                              }
                        }],
                        yAxes: [{
                            display: true,
                            scaleLabel: {
                                display: true,
                                labelString: 'NUMBER OF STUDENTS',
                                fontColor: 'white',
                                fontSize:25
                            },
                            ticks: {
                                  fontColor: "white",
                                  fontSize: 20
                            }
                        }]
                    }
                }
            });
        }

        if (tt == 'pie' || tt == 'polarArea' || tt == 'radar'){
            if (myChart) {
                myChart.destroy();
            }
            var ctx = document.getElementById('myDiv').getContext('2d');
            myChart = new Chart(ctx, {
                type: tt,
                data: {
                    labels: xvalues,
                    datasets: [{
                        label: 'no.std',
                        data: yvalues,
                        backgroundColor: [

                           '#32cd32',
                            'rgba(255,128,0)',
                            'rgba(255,255,0)',
                            '#eeeed1',
                            '#171717',
                            'rgba(255,0,255)',
                            'rgba(255,0,128)',
                            '#bf3eff',
                            'rgba(0,0,255)',
                            '#ee9572',
                            'rgba(255,0,0)'


                        ],
                        options: {
                            layout: {
                                padding: {
                                    left: 50,
                                    right: 0,
                                    top: 0,
                                    bottom: 0
                                }
                            }
                        },
                        borderColor: [
                            'black',
                            'black',
                            'black',
                            'black',
                            'black',
                            'black',
                            'black',
                            'black',
                            'black',
                            'black',
                            'black',

                        ],
                        borderWidth: 1
                    }]
                },
                    options: {
                        title: {
                            display: true,
                            text: 'UNIVERSITY OF THE WITWATERSRAND',
                            fontSize: 44
                        },
                    scales: {
                        xAxes: [{
                            display: false,
                            scaleLabel: {
                                display: true,
                                labelString: 'YEARS',
                                fontColor:'#000000',
                                fontSize:25
                            },
                            ticks: {
                               fontColor: "black",
                               fontSize: 20
                              }
                        }],
                        yAxes: [{
                            display: false,
                            scaleLabel: {
                                display: true,
                                labelString: 'NUMBER OF STUDENTS',
                                fontColor: 'black',
                                fontSize:25
                            },
                            ticks: {
                                  fontColor: "black",
                                  fontSize: 20
                            }
                        }]
                    }
                }
            });
        }
   }
});

</script>
</div>

{% endblock content %}

